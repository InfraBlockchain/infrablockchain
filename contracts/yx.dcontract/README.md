# Abtract
* This Yosemite contract provides the infrastructure for creation of digital contracts and digital signing service for them.
* The name is `yx.dcontract`.

# Digital Signing
* The features related to digital signing are part of public key cryptography.
   * Most blockchains including Yosemite Public Blockchain(YosemiteChain or Yosemite) have their account system based on public key cryptography. Digital signing is natural to YosemiteChain.
* In most cases, an account of YosemiteChain has its own private key and the public key, which are the key pair that can never be changed after created.
* The integrity of the digital signature created by the private key can be checked by anyone who knows its paired public key.
   * For more information, refer to https://en.wikipedia.org/wiki/Digital_signature and https://en.wikipedia.org/wiki/Public-key_cryptography
* YosemiteChain can check the integrity of the digital signature with all accounts because it has all the public keys of accounts.

## digital signing of the action of digital contract creation
* When a creation action is delivered to this Yosemite contract, it checks that the action is sent by the service provider who wants to create the digital contract.
* The creation action includes the list of accounts who are contract signers for `sign` action.

## digital signing of the digital contract
* An action for digital contract signing must be signed by one of the contract signers, not the service provider.
* Digital signature embedded in the action cryptographically proves that one of the contract signers actually signs the digital contract.

# Management Actions

## setting fee for actions
* Transaction fee for operations is set by [yx.txfee](../../contracts/yx.txfee/)::settxfee operation.
```
cleos push action yx.txfee settxfee '{"operation":"tf.dccreate", "fee":"50.0000 DKRW"}}' -p eosio
cleos push action yx.txfee settxfee '{"operation":"tf.dcaddsign", "fee":"10.0000 DKRW"}}' -p eosio
cleos push action yx.txfee settxfee '{"operation":"tf.dcsign", "fee":"30.0000 DKRW"}}' -p eosio
cleos push action yx.txfee settxfee '{"operation":"tf.dcupadd", "fee":"5.0000 DKRW"}}' -p eosio
cleos push action yx.txfee settxfee '{"operation":"tf.dcremove", "fee":"0.0000 DKRW"}}' -p eosio
```


# Actions

## create
Create a digital contract

```
cleos push action yx.dcontract create '{"dcid":{"creator":"servprovider","sequence":1},"conhash":"123456","adddochash":"","signers":["user1", "user2"],"expiration":"2018-08-31T02:49:57","options":0}' -p servprovider
```

### parameters of create
1. dcid : digital contract identifier
   * creator : account who creates the digital contract; this account pays the transaction fee
   * sequence : 64-bit unsigned integer generated by the caller of the action; **it must be unique**
1. conhash : string of contract hash
   * It cannot be longer than 256 and cannot be empty.
   * We recommend to use the returned hash string from IPFS which can be the document storage.
1. adddochash : string of additional document hash; this can be updated even after digital signing is done
   * It cannot be longer than 256 and can be empty.
1. signers : list of account name
   * The size of the list cannot be larger than 32 and cannot be 0.
1. expiration : expiration time in the ISO8601 format, combined date and time to seconds in UTC e.g. 2018-08-31T02:49:57
   * YosemiteChain assumes that the time-zone of the expiration time is UTC. Other time-zones are not considered.
   * Based on the time the action is executed at the YosemiteChain node, more than 1 minute must be specified.  
1. options : reserved

## sign
Sign the digital contract by the signer

```
cleos push action yx.dcontract sign '{"dcid":{"creator":"servprovider", "sequence":"1"}, "signer":"user1", "signerinfo":""}' -p user1
cleos push action yx.dcontract sign '{"dcid":{"creator":"servprovider", "sequence":"1"}, "signer":"user2", "signerinfo":"foo"}' -p user2
```

### parameters of sign
1. dcid : digital contract identifier provided to `create` action
1. signer : account name included in the signers of the digital contract
1. signerinfo : additional information string for the signer
   * It cannot be longer than 256 and can be empty.

## addsigners
Add additional signers to the created digital contract

* The action fails if one of the signers has already signed the contract.
```
cleos push action yx.dcontract addsigners '{"dcid":{"creator":"servprovider", "sequence":"1"}, "signers":["user3"]}' -p servprovider
```

### parameters of addsigners
1. dcid : digital contract identifier provided to `create` action
1. signers : list of account name
   * The size of the list cannot be larger than 32.


## upadddochash
Update the additional document hash string

* This action succeeds even if the signing has all done or the contract has been expired.
```
cleos push action yx.dcontract upadddochash '{"dcid":{"creator":"servprovider", "sequence":"1"}, "adddochash":"updated"}' -p servprovider
```

### parameters of upadddochash
1. dcid : digital contract identifier provided to `create` action
1. adddochash : string of additional document hash
   * It cannot be longer than 256 and can be empty.


## remove
Remove the digital contract from the YosemiteChain RAM database

* It is recommended to use this action regularly to save the storage of YosemiteChain RAM database.
```
cleos push action yx.dcontract remove '{"dcid":{"creator":"servprovider", "sequence":"1"}}' -p servprovider
```
### parameters of remove
1. dcid : digital contract identifier provided to `create` action


# Tables

## dcontracts
Get digital contract information

```
cleos get table yx.dcontract servprovider dcontracts
```
### result of dcontracts
```
{
  "rows": [{
      "sequence": 1,
      "conhash": "313233343536",
      "adddochash": "",
      "expiration": "2018-08-31T02:49:57",
      "options": 0,
      "signers": [
        "user1",
        "user2",
        "user3"
      ],
      "done_signers": [
        0,
        1
      ]
    },{
      "sequence": 2,
      "conhash": "313233343536",
      "adddochash": "",
      "expiration": "2018-08-31T02:49:57",
      "options": 0,
      "signers": [
        "user1",
        "user2"
      ],
      "done_signers": []
    }
  ],
  "more": false
}
```

## signers
Get the signer information

```
cleos get table yx.dcontract user1 signers
cleos get table yx.dcontract user2 signers
```
### result of signers
```
$ cleos get table yx.dcontract user1 signers
{
  "rows": [{
      "id": 0,
      "dcid_serialized": "0x01000000000000007055729bdebaafc2",
      "signerinfo": ""
    }
  ],
  "more": false
}

$ cleos get table yx.dcontract user2 signers
{
  "rows": [{
      "id": 0,
      "dcid_serialized": "0x01000000000000007055729bdebaafc2",
      "signerinfo": "666f6f"
    }
  ],
  "more": false
}
```

## get the signer information by dcid
